--source include/have_tianmu.inc

--echo #
--echo # Test cases for UNION
--echo #

--disable_warnings
DROP DATABASE IF EXISTS union_test;
--enable_warnings

CREATE DATABASE union_test;
USE union_test;

--echo #
--echo # UNION for INT and INT SIGNED
--echo #

CREATE TABLE t1 (a INT, b INT SIGNED);
INSERT INTO t1 VALUES (-1, 1), (-1, 1), (-2, 2);
SELECT * FROM (SELECT * FROM t1 UNION SELECT * FROM t1) tttt ORDER BY b;
SELECT * FROM (SELECT a FROM t1 UNION SELECT b FROM t1) tttt ORDER BY a;
SELECT * FROM (SELECT b FROM t1 UNION SELECT a FROM t1) tttt ORDER BY b;
DROP TABLE t1;

--echo #
--echo # Multiple Columns Union
--echo #

CREATE TABLE t1 (a INT, b INT, c INT);
INSERT INTO t1 VALUES (-1, 1, 0), (-2, 2, 0), (-3, 3, 0), (-4, 4, 0), (-5, 5, 0), (-1, 1, 0), (-2, 2, 0), (-3, 3, 0), (-4, 4, 0), (-5, 5, 0);
SELECT * FROM (SELECT * FROM t1 UNION ALL SELECT * FROM t1) tttt ORDER BY b;
SELECT * FROM (SELECT a FROM t1 UNION ALL SELECT b FROM t1) tttt ORDER BY a;
SELECT * FROM (SELECT b FROM t1 UNION ALL SELECT a FROM t1) tttt ORDER BY b;
DROP TABLE t1;

--echo #
--echo # Same Int Type Union
--echo #

CREATE TABLE t1 (a INT SIGNED, b INT SIGNED);
INSERT INTO t1 VALUES (1, 1), (1, 1), (2, 1), (2, 1), (3, 2), (4, 2), (5, 2);
SELECT * FROM (SELECT a FROM t1 UNION SELECT b FROM t1) tttt ORDER BY a;
SELECT * FROM (SELECT b FROM t1 UNION SELECT a FROM t1) tttt ORDER BY b;
SELECT * FROM (SELECT * FROM t1 UNION SELECT * FROM t1) tttt ORDER BY a;
DROP TABLE t1;

CREATE TABLE t1 (a INT, b INT);
INSERT INTO t1 VALUES (-1, -1), (-1, -1), (2, 1), (2, 1), (3, 2), (4, 2), (5, 2);
SELECT * FROM (SELECT a FROM t1 UNION SELECT b FROM t1) tttt ORDER BY a;
SELECT * FROM (SELECT b FROM t1 UNION SELECT a FROM t1) tttt ORDER BY b;
SELECT * FROM (SELECT * FROM t1 UNION SELECT * FROM t1) tttt ORDER BY a;
DROP TABLE t1;

--echo #
--echo # Signed Int Union
--echo #

CREATE TABLE t1 (a TINYINT);
INSERT INTO t1 VALUES (CAST(0xFFFFFFFFFFFFFF80 AS SIGNED)+2),(-1),(0),(1),(0x7F);
CREATE TABLE t2 (a SMALLINT);
INSERT INTO t2 VALUES (CAST(0xFFFFFFFFFFFF8000 AS SIGNED)+2),(-1),(0),(1),(0x7FFF);
SELECT * FROM (SELECT a FROM t1 UNION ALL SELECT a FROM t2) tttt ORDER BY a;
SELECT * FROM (SELECT a FROM t2 UNION ALL SELECT a FROM t1) tttt ORDER BY a;
DROP TABLE t2;

CREATE TABLE t2 (a MEDIUMINT);
INSERT INTO t2 VALUES (CAST(0xFFFFFFFFFF800000 AS SIGNED)+2),(-1),(0),(1),(0x7FFFFF);
SELECT * FROM (SELECT a FROM t1 UNION ALL SELECT a FROM t2) tttt ORDER BY a;
SELECT * FROM (SELECT a FROM t2 UNION ALL SELECT a FROM t1) tttt ORDER BY a;
DROP TABLE t2;

CREATE TABLE t2 (a INT);
INSERT INTO t2 VALUES (CAST(0xFFFFFFFF80000000 AS SIGNED)+2),(-1),(0),(1),(0x7FFFFFFF);
SELECT * FROM (SELECT a FROM t1 UNION ALL SELECT a FROM t2) tttt ORDER BY a;
SELECT * FROM (SELECT a FROM t2 UNION ALL SELECT a FROM t1) tttt ORDER BY a;
DROP TABLE t2;

CREATE TABLE t2 (a BIGINT);
INSERT INTO t2 VALUES (CAST(0x8000000000000000 AS SIGNED)+2),(-1),(0),(1),(0x7FFFFFFFFFFFFFFF);
SELECT * FROM (SELECT a FROM t1 UNION ALL SELECT a FROM t2) tttt ORDER BY a;
SELECT * FROM (SELECT a FROM t2 UNION ALL SELECT a FROM t1) tttt ORDER BY a;
DROP TABLE t1,t2;

CREATE TABLE t1 (a SMALLINT);
INSERT INTO t1 VALUES (CAST(0xFFFFFFFFFFFF8000 AS SIGNED)+2),(-1),(0),(1),(0x7FFF);
CREATE TABLE t2 (a MEDIUMINT);
INSERT INTO t2 VALUES (CAST(0xFFFFFFFFFF800000 AS SIGNED)+2),(-1),(0),(1),(0x7FFFFF);
SELECT * FROM (SELECT a FROM t1 UNION ALL SELECT a FROM t2) tttt ORDER BY a;
SELECT * FROM (SELECT a FROM t2 UNION ALL SELECT a FROM t1) tttt ORDER BY a;
DROP TABLE t2;

CREATE TABLE t2 (a INT);
INSERT INTO t2 VALUES (CAST(0xFFFFFFFF80000000 AS SIGNED)+2),(-1),(0),(1),(0x7FFFFFFF);
SELECT * FROM (SELECT a FROM t1 UNION ALL SELECT a FROM t2) tttt ORDER BY a;
SELECT * FROM (SELECT a FROM t2 UNION ALL SELECT a FROM t1) tttt ORDER BY a;
DROP TABLE t2;

CREATE TABLE t2 (a BIGINT);
INSERT INTO t2 VALUES (CAST(0x8000000000000000 AS SIGNED)+2),(-1),(0),(1),(0x7FFFFFFFFFFFFFFF);
SELECT * FROM (SELECT a FROM t1 UNION ALL SELECT a FROM t2) tttt ORDER BY a;
SELECT * FROM (SELECT a FROM t2 UNION ALL SELECT a FROM t1) tttt ORDER BY a;
DROP TABLE t1,t2;

CREATE TABLE t1 (a MEDIUMINT);
INSERT INTO t1 VALUES (CAST(0xFFFFFFFFFF800000 AS SIGNED)+2),(-1),(0),(1),(0x7FFFFF);
CREATE TABLE t2 (a INT);
INSERT INTO t2 VALUES (CAST(0xFFFFFFFF80000000 AS SIGNED)+2),(-1),(0),(1),(0x7FFFFFFF);
SELECT * FROM (SELECT a FROM t1 UNION ALL SELECT a FROM t2) tttt ORDER BY a;
SELECT * FROM (SELECT a FROM t2 UNION ALL SELECT a FROM t1) tttt ORDER BY a;
DROP TABLE t2;

CREATE TABLE t2 (a BIGINT);
INSERT INTO t2 VALUES (CAST(0x8000000000000000 AS SIGNED)+2),(-1),(0),(1),(0x7FFFFFFFFFFFFFFF);
SELECT * FROM (SELECT a FROM t1 UNION ALL SELECT a FROM t2) tttt ORDER BY a;
#SELECT * FROM (SELECT a FROM t2 UNION ALL SELECT a FROM t1) tttt ORDER BY a;
DROP TABLE t1,t2;

CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (CAST(0xFFFFFFFF80000000 AS SIGNED)+2),(-1),(0),(1),(0x7FFFFFFF);
CREATE TABLE t2 (a BIGINT);
INSERT INTO t2 VALUES (CAST(0x8000000000000000 AS SIGNED)+2),(-1),(0),(1),(0x7FFFFFFFFFFFFFFF);
SELECT * FROM (SELECT a FROM t1 UNION ALL SELECT a FROM t2) tttt ORDER BY a;
SELECT * FROM (SELECT a FROM t2 UNION ALL SELECT a FROM t1) tttt ORDER BY a;
DROP TABLE t1,t2;

CREATE TABLE t1 (a MEDIUMINT);
INSERT INTO t1 VALUES (CAST(0xFFFFFFFFFF800000 AS SIGNED)+2),(-1),(0),(1),(0x7FFFFF);
CREATE TABLE t2 (a BIGINT);
INSERT INTO t2 VALUES (CAST(0x8000000000000000 AS SIGNED)+2),(-1),(0),(1),(0x7FFFFFFFFFFFFFFF);
SELECT a FROM t1 UNION ALL SELECT a FROM t2;
DROP TABLE t1,t2;

CREATE TABLE t1 (a MEDIUMINT);
INSERT INTO t1 VALUES (CAST(0xFFFFFFFFFF800000 AS SIGNED)+2),(-1),(0),(1),(0x7FFFFF);
CREATE TABLE t2 (a CHAR(10));
INSERT INTO t2 VALUES ("12"),("34"),("56"),("78"),("910");
SELECT a FROM t1 UNION ALL SELECT a FROM t2;
DROP TABLE t1,t2;

CREATE TABLE t1 (a VARCHAR(8));
INSERT INTO t1 VALUES ("11111111"),("22222222"),("33333333"),("44444444"),("55555555");
CREATE TABLE t2 (a CHAR(5));
INSERT INTO t2 VALUES ("12"),("34"),("56"),("78"),("910");
SELECT a FROM t1 UNION ALL SELECT a FROM t2;
DROP TABLE t1,t2;

#
# echo datetime/date/timestamp union datetime/date/timestamp
#
CREATE TABLE t1 (a datetime);
INSERT INTO t1 VALUES ("2022-08-20 12:00:00"),("2022-08-21 12:00:00"),("2022-08-22 12:00:00"),("2022-08-23 12:00:00");
CREATE TABLE t2 (a timestamp);
INSERT INTO t2 VALUES ("2021-07-20 12:30:00"),("2021-07-21 12:30:00"),("2021-07-22 12:30:00"),("2021-07-23 12:30:00");
CREATE TABLE t3 (a date);
INSERT INTO t3 VALUES ("2020-06-10"),("2020-06-11"),("2020-06-12"),("2020-06-13");

# datetime union timestamp
SELECT a FROM t1 UNION SELECT a FROM t2;
SELECT a FROM t2 UNION SELECT a FROM t1;
SELECT a FROM t1 where a is null UNION SELECT a FROM t2;
SELECT a FROM t1 UNION SELECT a FROM t2 where a is null;


# datetime union date
SELECT a FROM t1 UNION SELECT a FROM t3;
SELECT a FROM t3 UNION SELECT a FROM t1;
SELECT a FROM t1 where a is null UNION SELECT a FROM t3;
SELECT a FROM t1 UNION SELECT a FROM t3 where a is null;

# timestamp union date
SELECT a FROM t2 UNION SELECT a FROM t3;
SELECT a FROM t3 UNION SELECT a FROM t2;
SELECT a FROM t2 where a is null UNION SELECT a FROM t3;
SELECT a FROM t2 UNION SELECT a FROM t3 where a is null;

DROP TABLE t1,t2,t3;
DROP DATABASE union_test;
